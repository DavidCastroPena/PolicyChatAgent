from retriever.QuestionsAndAnswers.answer_questions import QuestionAnswerer
import os
from dotenv import load_dotenv
from datetime import datetime
import google.generativeai as genai
import json
from pathlib import Path 




load_dotenv()

gemini_api_key = os.getenv("GEMINI_API_KEY")

class GenerateMemo:
    def __init__(self, message_output=None, shared_timestamp=None):
        self.answer_list = []   
        self.message_output = message_output or print
        self.evidence_summary = None  # Will be set by coordinator
        self.shared_timestamp = shared_timestamp  # Store shared timestamp

    def message(self, text):
        """
        Utility method to output messages
        """
        if self.message_output:
            self.message_output(text)

    def generate_memo(self, query, questions_str):

        self.message("üôåüèº Putting everything together ...") 
        self.message("ü§ñ Generating policy memo that summarizes the findings ...")  

        genai.configure(api_key=gemini_api_key)
        
        # GEMINI SET UP
        generation_config = {
            "temperature": 0.2,
            "top_p": 0.95,
            "top_k": 5,
            "max_output_tokens": 8192,
            "response_mime_type": "text/plain",
        }

        current_dir = os.getcwd()  # Get the current working directory
        file_path = os.path.join(
            current_dir, "retriever", "prompt.txt"
        )

        # Read the content of the prompt.txt file
        with open(file_path, "r") as file:
            template = file.read()

        # Replace {query} in the template with the value of query
        prompt = template.format(query=query, questions = questions_str)

        model = genai.GenerativeModel(
            model_name="gemini-2.0-flash-exp",
            generation_config=generation_config,
            system_instruction=prompt
        )
        response = model.generate_content(self.answer_list)

        response = response.text

        # Prepend light CSS for table styling so Streamlit renders nicer tables
        style_block = """
<style>
  .memo-table { width: 100%; border-collapse: collapse; overflow-x: auto; display: block; }
  .memo-table th, .memo-table td { border: 1px solid #ddd; padding: 8px; }
  .memo-table th { background-color: #f6f8fa; text-align: left; }
  .memo-container { overflow-x: auto; }
  .memo-table tr:nth-child(even){ background-color: #fbfbfb; }
</style>

"""

        # Use shared timestamp if provided, otherwise generate new one
        timestamp = self.shared_timestamp or datetime.now().strftime("%Y%m%d_%H%M%S")
        
        # Create reports/memos directory if it doesn't exist
        memos_dir = Path("./reports/memos")
        memos_dir.mkdir(parents=True, exist_ok=True)
        memo_file = memos_dir / f"memo_{timestamp}.md"
        
        # Prepend evidence quality summary if available
        if self.evidence_summary:
            s = self.evidence_summary
            evidence_header = f"""
## Evidence Quality Summary

- **Papers Retrieved**: {s.get('retrieved_total', 0)} from Semantic Scholar
- **Unique Papers (Deduped)**: {s.get('deduped_count', 0)}
- **Papers Analyzed**: {s.get('selected_for_llm', 0)} high-quality papers sent to LLM
- **Quality Tiers**: A={s.get('tier_counts_selected', {}).get('A', 0)}, B={s.get('tier_counts_selected', {}).get('B', 0)}, C={s.get('tier_counts_selected', {}).get('C', 0)}
- **Colombia-Relevant Papers**: {s.get('colombia_context_count', 0)}/{s.get('scored_count', 0)}

---

"""

        # Write the response to the file with a style block to improve table rendering
        with open(memo_file, "w", encoding='utf-8') as file:
            file.write(style_block + "\n" + evidence_header + response)
        
        # Verify file exists and report absolute path
        memo_file_abs = os.path.abspath(memo_file)
        if os.path.exists(memo_file_abs):
            print(f"‚úÖ Memo saved to {memo_file_abs}")
            self.message(f"üóÉÔ∏è Memo file saved to {memo_file}.")
            return memo_file_abs  # Return path for verification
        else:
            # Debug info if file doesn't exist
            cwd = os.getcwd()
            memo_dir_files = os.listdir(memo_dir)[:10] if os.path.exists(memo_dir) else []
            print(f"‚ùå ERROR: Memo file not found after save!")
            print(f"   Attempted path: {memo_file_abs}")
            print(f"   Current working directory: {cwd}")
            print(f"   Files in {memo_dir}: {memo_dir_files}")
            self.message(f"‚ö†Ô∏è Warning: Memo file save verification failed")
            return None 
    
    def run(self, all_external_content, content_by_paper_id, user_query):

        answer = QuestionAnswerer(message_output=self.message_output)
        answer.run(user_query=user_query, all_external_content= all_external_content, external_content_by_paper_id =  content_by_paper_id)
        
        # Retrieve the shared timestamp from QuestionAnswerer if available
        if hasattr(answer, 'shared_timestamp') and answer.shared_timestamp:
            self.shared_timestamp = answer.shared_timestamp
            print(f"üìÖ Using shared timestamp from questions: {self.shared_timestamp}")
        
        current_dir = Path(__file__).resolve().parent
        # Navigate to the parent directory and then to the target file
        file_path = current_dir.parent.parent / 'paper_answers.json'
        
        with open(file_path, 'r') as f:
            answer_list = json.load(f)
        
        answer_list = str(answer_list)
        

        self.answer_list = answer_list
        print("Aaaaaanswer", self.answer_list)

        try:
            # Define the directory containing the files
            questions_dir = Path("./reports/questions")
            files = list(questions_dir.glob("comparison_questions_*.txt")) if questions_dir.exists() else []
            
            # Fallback to root directory for backward compatibility
            if not files:
                parent_dir = Path(os.getcwd())
                files = list(parent_dir.glob("comparison_questions_*.txt"))
            
            if not files:
                print("No comparison questions files found.")
                return None
            
            # Sort files by modification time in descending order
            latest_questions_file = max(files, key=lambda f: f.stat().st_mtime)
        
        except Exception as e:
            print(f"Error accessing directory: {e}")
 
        # Read the file content as a string
        try:
            with open(latest_questions_file, 'r', encoding='utf-8') as f:
                question_str = f.read()  # Read the entire file as a string
        except Exception as e:
            print(f"\nError reading questions file: {e}")

        memo_path = self.generate_memo(user_query, question_str)
        return memo_path


def main():
    
    all_external_content = ['Assessing the needs of women who use drugs requires a comprehensive understanding of gender and intersectionality. Gender refers to socially constructed roles that vary based on time and place, and gender identity reflects one\'s internal sense of being a woman, man, or anywhere along the gender spectrum, including transgender, nonbinary, and genderqueer identities. In this article and in the fellowship track, we define \'women\' as all individuals who identify as a woman, regardless of their sex (classification as male or female based on biological attributes). Intersectional perspectives recognize that women\'s experiences with drug use are not homogeneous. Rather, other intersecting identities, such as gender identity, sexual orientation, race/ethnicity, and socioeconomic class shape individual experiences of oppression or empowerment [5]. In particular, structural racism, homophobia, and transphobia enhance discrimination and treatment barriers for Black, Indigenous, and other racialized individuals and for transgender and genderqueer individuals compared to White cis-gender women who use drugs.\n\nWomen who use drugs interact with individuals, communities, and social systems that reproduce structural sexism. Structural sexism is defined as "discriminatory beliefs or practices on the basis of sex and gender that are entrenched in societal frameworks and which result in fairly predictable disparities in social outcomes related to power, resources, and opportunities" [7]. For example, gender-based power dynamics in drug-using communities may restrict women\'s autonomy to determine when, how, and why they use drugs. Such power imbalances are associated with greater adverse consequences in women compared to men including higher rates of injection drug use-associated infections, co-occurring mood and anxiety disorders, and experiences of intimate partner violence and sexual exploitation [8,9].\n\nStructural sexism is also apparent in the systems that affect pregnant and parenting people who use drugs. Pregnant individuals who use drugs face punitive consequences from legal and child welfare systems, hostility from the general public, and an addiction treatment system that is poorly suited to meet their needs. The child welfare system has traditionally viewed prenatal and parental substance use as synonymous with abuse or neglect, causing heightened shame, stigma, and fear of seeking treatment. Black and Indigenous women are disproportionately harmed by trauma related to child welfare service reporting and custody loss.', "This research contributes to a growing body of literature on integrated harm reduction approaches for supporting women, girls, and gender diverse people with substance use challenges and other complex needs.In particular, this study informs our understanding and subsequent ability to address the needs of women and girls who access substance use treatment, with consideration of factors that may support program completion and long-term success.Moreover, this study has the potential to guide evolving best practice at the 2nd Floor Women's Recovery Centre and beyond and has significant policy implications with respect to the prioritization, design, and implementation of interventions and frameworks that reduce the likelihood of substance-exposed pregnancies, ultimately supporting health and wellbeing for parents, children, families, and communities.", '1. Understanding sex, gender, and gender differences in drug use 2. Structural sexism and intersectionality 3. Substance use in adolescents and young adults, including girls under age 18 4. Substance use in transgender, non-binary, and genderqueer populations 5. Perinatal treatment of SUD, including management of OUD 6. Neonatal withdrawal syndromes 7. Child welfare system involvement in people with SUD 8. Contraception and abortion for people who use drugs 9. Gender-responsive care 10. Sex work and substance use 11. Intimate partner violence and substance use 12. Trauma-informed care for women who use drugs 13. Co-occurring SUD and psychiatric disorders Self-directed learning resources: Educational activities and practice resources:  \n\n1. Understanding sex, gender, and gender differences in drug use 2. Structural sexism and intersectionality 3. Substance use in adolescents and young adults, including girls under age 18 4. Substance use in transgender, non-binary, and genderqueer populations 5. Perinatal treatment of SUD, including management of OUD 6. Neonatal withdrawal syndromes 7. Child welfare system involvement in people with SUD 8. Contraception and abortion for people who use drugs 9. Gender-responsive care 10. Sex work and substance use 11. Intimate partner violence and substance use 12. Trauma-informed care for women who use drugs 13. Co-occurring SUD and psychiatric disorders Self-directed learning resources: Educational activities and practice resources:', 'Our findings suggest that addressing the basics needs such as food, clothing, safety, and housing of female drug users who lack these necessities may support improved access to care. State Medicaid programs may be well-positioned to lead on this front given their flexibility in program design, waiver authority, ability to offer provider incentive payments, and the patient populations they support. 25 In California, one novel approach to integrating health and social needs is the Whole Person Care Medicaid Section 1115 wavier demonstration, launched in 2016, which provides patients from stateidentified high risk groups (including patients with substance use disorder) with integrated local systems of healthcare, behavioral, and social services. 26 Implemented at the local level, the Whole Person Care pilot programs coordinate services through partnerships between health agencies, the social safety net, and Medicaid managed care plans.\n\nHealthcare providers should be emboldened with the time and resources to adequately address the comorbidity of substance abuse and mental illness. This would allow for better detection of substance abuse and mental illness comorbidity to be identified and treated regardless of the financial resources of the patient. Furthermore, health systems should create safe spaces that allow women with limited social stability to be able to access care free of charge to remove the burden of cost from care. 27 To contend with drug dependence, we must address mental health issues and create curated programs that address the specific needs of women who use drugs, focusing on the demonstrated effectiveness of targeted interventions rather than criminalization. [28][29][30][31] Moving forward, studies should focus on drug use among specific ethnic minority populations. There is a lack of literature on the impact of social determinants of health on mental health access of the Black and Hispanic population who use illicit drugs, as well as studies that directly compare drug user and non-user health outcomes. Future research should investigate the effectiveness of gender-based drug program treatment with a special focus on the needs of female drug users with mental health disorders.', 'Little research to date has examined interventions designed specifically to address substance use problems in women on welfare. Generally, studies indicate that these women have myriad co-occurring problems in the areas of mental health, domestic violence, and medical care, as well as legal issues. Thus, interventions designed to specifically address substance abuse may not effectively address the significant and chronic problems experienced by women receiving welfare benefits. Interventions that provide gender-specific services and coordination across multiple service domains to address the co-occurring problems these women experience may be most effective.\n\nTwo recent studies examined the effectiveness of case management (CM) at addressing the multiple problems experienced by substance-abusing women on welfare: CASAWORKS for Families (CWF) (Morgenstern et al. 2003b) and CASASARD (Morgenstern et al. 2001b). These CM interventions, designed specifically for TANF women, provided linkages to needed wraparound services in many areas, including housing assistance, mental health treatment, medical treatment, child care, and transportation. Additionally, when possible, services were tailored to women by referring clients to treatment programs that had female therapists, women-only groups, and child care.\n\nCWF was a demonstration program testing an inten sive intervention for TANF women with substance use problems in 10 counties around the country (Morgenstern et al. 2003b). CWF offered client-level case management and fostered interagency coordination to ensure that clients had access to ancillary services. The study did not employ a control group, but researchers conducted a rigorous evaluation of CWF with 698 women receiving treatment at 10 sites. An independent evaluation of this demonstration project produced promising findings (McLellan et al. 2003). Women had high rates of reten tion (51 percent were still in treatment 6 months after beginning treatment) and received substantial amounts of ancillary services. Followup at 12 months showed Prevalence of barriers to employment among substance-abusing and non-substance-abusing female welfare recipients. On average, more than twice as many substance-abusing women experienced severe barriers to employment com pared with non-substance-abusing women. that the women had significant and meaningful reductions in substance use (78 percent reported no heavy alcohol use in the previous 6 months), increases in employment (41 percent were employed at least part-time at the 12month followup), and decreases in welfare dependency.', 'The human and economic costs of substance use are considerable [1,2]. Although rates of substance use generally are lower for women than for men [3][4][5], the physical and mental health consequences can be more profound for women [6]. Women who use alcohol and illicit drugs are at particular risk for hepatitis C and HIV infection, and are more likely to have psychiatric co-morbidity and multimorbidity [7]. In addition, substance use during pregnancy and while mothering has negative consequences for children, including risk for prematurity, impaired physical growth and development, physical and mental health problems, and development of substance use problems [8][9][10][11]. There is a need for services that effectively and comprehensively address the complex needs of women with substance use issues and their children. In addition to experiencing physical and mental health problems, these women often have personal histories of exposure to physical and sexual abuse and other relationship problems, negative or inadequate social support systems, inadequate income, unemployment, unstable housing, and involvement with the criminal justice system [12][13][14]. Conners and colleagues [9] suggested that an accumulation of these postnatal environmental risk conditions combined with prenatal substance exposure results in increased childhood vulnerability to poor outcomes. As these authors note, the issues mothers face can "limit their ability to provide for their child\'s physical and/or emotional needs" (p. 90). Maternal substance use has been associated with limited parenting capacity and an increased likelihood that children are exposed to maltreatment, including neglect [8,[15][16][17], factors that have negative developmental sequelae for children. Children of women with substance use issues are further compromised because they have limited opportunities to develop the social skills and relationships that can help to buffer against risk [9].', "levels of homelessness (58%) and food insecurity (89.5%).Conclusion: Study findings underscore the need for better understanding of the existing capabilities of WESW and those who use drugs, including financial autonomy and communityThis is an open-access article distributed under the terms and conditions of the Creative Commons Attribution license supports, that may guide the design of programs that most effectively promote women's economic well-being and ensure that it is not at the expense of wellness and safety. Designing such programs requires incorporating a social justice lens into social work and public health interventions, including HIV prevention, and attention to the human rights of the most marginalized and highest risk populations, including WESW and those who use drugs.Keywordswomen engaged in sex work; FSW; drug use; financial lives; paradoxical autonomy Yang et al.", 'Women comprise one-third of people who use drugs globally and account for one-fifth of the estimated global number of people who inject drugs [1].Women comprised one-third of overdose deaths in the US and about one in four in Canada in 2017-18.The rate of fatal overdoses among women has increased by 260-500% in the last two decades [2].Women also suffer serious longterm social and health consequences of incarceration related to drug use and drug-related offenses which are different to those suffered by men [3][4][5].The latest European report on Women and Drugs estimated one in four people with serious drug problems and one in five entrants to treatment programs were women.Despite the disease burden, the report lamented limited availability of integrated and coordinated national-level genderspecific services and gender-mainstreaming responses of drug use-related problems [6]. Women face particular challenges related to drugs including gender, effects of drug use during pregnancy (e.g., neonatal abstinence syndrome, low birth weight, and premature birth), motherhood, gender-based violence, higher involvement in sex work, higher prevalence of (sexual) trauma, double stigma (being discriminated against for being a woman and persons who use drugs) with serious psychosocial consequences [7].These challenges require gender-specific policy responses.Drug policy should be well-aligned with the objectives of sustainable development goals (SDG-2030), which envisage gender equality and empowerment [8].Therefore, it is important to assess whether women who use drugs currently receive attention in drug policies and programs and in what ways.Assessing gender-specific elements of national', "assets [18]. If such guidelines are not followed, they may lose future funding and are penalized for every dollar they go over the designated maximum alliance for individual assets. Even if there may be a desire to work and to save money, government regulations may produce a disincentive to both. For women who are recovering from substance dependence and other related adverse life events (such as HIV infection, poor health, intimate partner violence, and mental health concerns), it may be difficult to see the value of engaging in economic empowerment activities with so little economic independence. This paper attempts to explore these issues to enhance our knowledge of effective interventions that support women on disability living in low-income communities and high-risk environments to gain access to the workforce. The Women's Economic Empowerment pilot (WEE) described here was initiated to better understand the acceptability and feasibility of implementing a structural intervention to promote women's economic empowerment in an urban context. Grounded in social cognitive [19,20] and asset theories [21], the intervention targeted behavior change by building women's self-efficacy in sexual health decision making and condom negotiation and use, while also promoting economic stability through training in financial literacy and the accumulation of economic assets. The study aimed to (1) explore whether a structural intervention combining health promotion with economic empowerment activities would be both acceptable and feasible among women receiving HIV prevention and related case management services in NYC and (2) obtain preliminary data that would support the design of a future efficacy trial. If we better understand the successes and challenges of implementation, we may improve the overall effectiveness of combination, structural economic empowerment interventions for low-income communities. As such, Figure 1 depicts the conceptual model for the combined intervention.", "Sample characteristics, stratified by gender identity, are reported in Table 2. Participants were on average 41 years old (SD = 12); and were mostly of Malay (42%), Indian (42%), or Chinese (9%) ethnicity. The majority of participants identified as Muslim (55%), followed by Hindu (27%), Buddhist (9%), Christian (6%), or Sikh (3%). Many participants reported not completing secondary school (45%) and less than half (46%) had children. Participants' demographic traits differed according to their gender identity, with a substantially higher proportion of TWSWs reporting being single (87%), having no children (87%), and holding some form of secondary schooling qualification (60%) when compared to CWSW. Moreover, a larger percentage of CWSWs reported being widowed/divorced (72%) in comparison to their TWSW counterparts.  Table 3 reports participants' patterns of income generation, stratified by gender identity. Participants reported having engaged in sex work for an average of 20 years (SD = 12); although, both CWSWs (61%) and TWSWs (72%) reported receiving income from non-sex work forms of work, including cleaning services, entertainment, and night club promotion. Participants' total mean monthly income was MYR 2235 (USD 521). Table 4 shows rates of lifetime drug use, stratified by gender identity. The most commonly used drugs were amphetaminetype substances (ATS) (50%), primarily crystal methamphetamine, followed by cannabis (36%) and heroin (27%). Engagement in drug use differed according to respondents' gender identity; with a higher percentage of CWSWs using ATS (61%) and/or heroine (44%) in comparison to TWSWs.\n\nThe in-depth interviews yielded three main themes regarding acceptability of a microfinance intervention: (a) participants were eager to engage in additional forms of income generation due to familial concerns and career aspirations; (b) interest in all proposed components of the intervention were driven by a desire to build their own business; and (c) potential challenges to developing businesses included a lack of financial resources, competition from other businesses, and fear of stigma."]

    content_by_title = {
        "Developing A Women'S Health Track Within Addiction Medicine Fellowship: Reflections And Inspirations": 'Assessing the needs of women who use drugs requires a comprehensive understanding of gender and intersectionality. Gender refers to socially constructed roles that vary based on time and place, and gender identity reflects one\'s internal sense of being a woman, man, or anywhere along the gender spectrum, including transgender, nonbinary, and genderqueer identities. In this article and in the fellowship track, we define \'women\' as all individuals who identify as a woman, regardless of their sex (classification as male or female based on biological attributes). Intersectional perspectives recognize that women\'s experiences with drug use are not homogeneous. Rather, other intersecting identities, such as gender identity, sexual orientation, race/ethnicity, and socioeconomic class shape individual experiences of oppression or empowerment [5]. In particular, structural racism, homophobia, and transphobia enhance discrimination and treatment barriers for Black, Indigenous, and other racialized individuals and for transgender and genderqueer individuals compared to White cis-gender women who use drugs.\n\nWomen who use drugs interact with individuals, communities, and social systems that reproduce structural sexism. Structural sexism is defined as "discriminatory beliefs or practices on the basis of sex and gender that are entrenched in societal frameworks and which result in fairly predictable disparities in social outcomes related to power, resources, and opportunities" [7]. For example, gender-based power dynamics in drug-using communities may restrict women\'s autonomy to determine when, how, and why they use drugs. Such power imbalances are associated with greater adverse consequences in women compared to men including higher rates of injection drug use-associated infections, co-occurring mood and anxiety disorders, and experiences of intimate partner violence and sexual exploitation [8,9].\n\nStructural sexism is also apparent in the systems that affect pregnant and parenting people who use drugs. Pregnant individuals who use drugs face punitive consequences from legal and child welfare systems, hostility from the general public, and an addiction treatment system that is poorly suited to meet their needs. The child welfare system has traditionally viewed prenatal and parental substance use as synonymous with abuse or neglect, causing heightened shame, stigma, and fear of seeking treatment. Black and Indigenous women are disproportionately harmed by trauma related to child welfare service reporting and custody loss. 1. Understanding sex, gender, and gender differences in drug use 2. Structural sexism and intersectionality 3. Substance use in adolescents and young adults, including girls under age 18 4. Substance use in transgender, non-binary, and genderqueer populations 5. Perinatal treatment of SUD, including management of OUD 6. Neonatal withdrawal syndromes 7. Child welfare system involvement in people with SUD 8. Contraception and abortion for people who use drugs 9. Gender-responsive care 10. Sex work and substance use 11. Intimate partner violence and substance use 12. Trauma-informed care for women who use drugs 13. Co-occurring SUD and psychiatric disorders Self-directed learning resources: Educational activities and practice resources:  \n\n1. Understanding sex, gender, and gender differences in drug use 2. Structural sexism and intersectionality 3. Substance use in adolescents and young adults, including girls under age 18 4. Substance use in transgender, non-binary, and genderqueer populations 5. Perinatal treatment of SUD, including management of OUD 6. Neonatal withdrawal syndromes 7. Child welfare system involvement in people with SUD 8. Contraception and abortion for people who use drugs 9. Gender-responsive care 10. Sex work and substance use 11. Intimate partner violence and substance use 12. Trauma-informed care for women who use drugs 13. Co-occurring SUD and psychiatric disorders Self-directed learning resources: Educational activities and practice resources:',
        'Integrated Supports For Women And Girls Experiencing Substance Use And Complex Needs': "This research contributes to a growing body of literature on integrated harm reduction approaches for supporting women, girls, and gender diverse people with substance use challenges and other complex needs.In particular, this study informs our understanding and subsequent ability to address the needs of women and girls who access substance use treatment, with consideration of factors that may support program completion and long-term success.Moreover, this study has the potential to guide evolving best practice at the 2nd Floor Women's Recovery Centre and beyond and has significant policy implications with respect to the prioritization, design, and implementation of interventions and frameworks that reduce the likelihood of substance-exposed pregnancies, ultimately supporting health and wellbeing for parents, children, families, and communities.",
        'Social Stability And Unmet Health Care Needs In A Community-Based Sample Of Women Who Use Drugs': 'Our findings suggest that addressing the basics needs such as food, clothing, safety, and housing of female drug users who lack these necessities may support improved access to care. State Medicaid programs may be well-positioned to lead on this front given their flexibility in program design, waiver authority, ability to offer provider incentive payments, and the patient populations they support. 25 In California, one novel approach to integrating health and social needs is the Whole Person Care Medicaid Section 1115 wavier demonstration, launched in 2016, which provides patients from stateidentified high risk groups (including patients with substance use disorder) with integrated local systems of healthcare, behavioral, and social services. 26 Implemented at the local level, the Whole Person Care pilot programs coordinate services through partnerships between health agencies, the social safety net, and Medicaid managed care plans.\n\nHealthcare providers should be emboldened with the time and resources to adequately address the comorbidity of substance abuse and mental illness. This would allow for better detection of substance abuse and mental illness comorbidity to be identified and treated regardless of the financial resources of the patient. Furthermore, health systems should create safe spaces that allow women with limited social stability to be able to access care free of charge to remove the burden of cost from care. 27 To contend with drug dependence, we must address mental health issues and create curated programs that address the specific needs of women who use drugs, focusing on the demonstrated effectiveness of targeted interventions rather than criminalization. [28][29][30][31] Moving forward, studies should focus on drug use among specific ethnic minority populations. There is a lack of literature on the impact of social determinants of health on mental health access of the Black and Hispanic population who use illicit drugs, as well as studies that directly compare drug user and non-user health outcomes. Future research should investigate the effectiveness of gender-based drug program treatment with a special focus on the needs of female drug users with mental health disorders.',
        'Welfare Reform And Substance Abuse Treatment For Welfare Recipients': 'Little research to date has examined interventions designed specifically to address substance use problems in women on welfare. Generally, studies indicate that these women have myriad co-occurring problems in the areas of mental health, domestic violence, and medical care, as well as legal issues. Thus, interventions designed to specifically address substance abuse may not effectively address the significant and chronic problems experienced by women receiving welfare benefits. Interventions that provide gender-specific services and coordination across multiple service domains to address the co-occurring problems these women experience may be most effective.\n\nTwo recent studies examined the effectiveness of case management (CM) at addressing the multiple problems experienced by substance-abusing women on welfare: CASAWORKS for Families (CWF) (Morgenstern et al. 2003b) and CASASARD (Morgenstern et al. 2001b). These CM interventions, designed specifically for TANF women, provided linkages to needed wraparound services in many areas, including housing assistance, mental health treatment, medical treatment, child care, and transportation. Additionally, when possible, services were tailored to women by referring clients to treatment programs that had female therapists, women-only groups, and child care.\n\nCWF was a demonstration program testing an inten sive intervention for TANF women with substance use problems in 10 counties around the country (Morgenstern et al. 2003b). CWF offered client-level case management and fostered interagency coordination to ensure that clients had access to ancillary services. The study did not employ a control group, but researchers conducted a rigorous evaluation of CWF with 698 women receiving treatment at 10 sites. An independent evaluation of this demonstration project produced promising findings (McLellan et al. 2003). Women had high rates of reten tion (51 percent were still in treatment 6 months after beginning treatment) and received substantial amounts of ancillary services. Followup at 12 months showed Prevalence of barriers to employment among substance-abusing and non-substance-abusing female welfare recipients. On average, more than twice as many substance-abusing women experienced severe barriers to employment com pared with non-substance-abusing women. that the women had significant and meaningful reductions in substance use (78 percent reported no heavy alcohol use in the previous 6 months), increases in employment (41 percent were employed at least part-time at the 12month followup), and decreases in welfare dependency.',
        'Harm Reduction Journal Integrated Programs For Women With Substance Use Issues And Their Children: A Qualitative Meta-Synthesis Of Processes And Outcomes': 'The human and economic costs of substance use are considerable [1,2]. Although rates of substance use generally are lower for women than for men [3][4][5], the physical and mental health consequences can be more profound for women [6]. Women who use alcohol and illicit drugs are at particular risk for hepatitis C and HIV infection, and are more likely to have psychiatric co-morbidity and multimorbidity [7]. In addition, substance use during pregnancy and while mothering has negative consequences for children, including risk for prematurity, impaired physical growth and development, physical and mental health problems, and development of substance use problems [8][9][10][11]. There is a need for services that effectively and comprehensively address the complex needs of women with substance use issues and their children. In addition to experiencing physical and mental health problems, these women often have personal histories of exposure to physical and sexual abuse and other relationship problems, negative or inadequate social support systems, inadequate income, unemployment, unstable housing, and involvement with the criminal justice system [12][13][14]. Conners and colleagues [9] suggested that an accumulation of these postnatal environmental risk conditions combined with prenatal substance exposure results in increased childhood vulnerability to poor outcomes. As these authors note, the issues mothers face can "limit their ability to provide for their child\'s physical and/or emotional needs" (p. 90). Maternal substance use has been associated with limited parenting capacity and an increased likelihood that children are exposed to maltreatment, including neglect [8,[15][16][17], factors that have negative developmental sequelae for children. Children of women with substance use issues are further compromised because they have limited opportunities to develop the social skills and relationships that can help to buffer against risk [9].',
        'The Financial Lives And Capabilities Of Women Engaged In Sex Work: Can Paradoxical Autonomy Inform Intervention Strategies? Hhs Public Access': "levels of homelessness (58%) and food insecurity (89.5%).Conclusion: Study findings underscore the need for better understanding of the existing capabilities of WESW and those who use drugs, including financial autonomy and communityThis is an open-access article distributed under the terms and conditions of the Creative Commons Attribution license supports, that may guide the design of programs that most effectively promote women's economic well-being and ensure that it is not at the expense of wellness and safety. Designing such programs requires incorporating a social justice lens into social work and public health interventions, including HIV prevention, and attention to the human rights of the most marginalized and highest risk populations, including WESW and those who use drugs.Keywordswomen engaged in sex work; FSW; drug use; financial lives; paradoxical autonomy Yang et al.",
        "Drug Policies' Sensitivity Towards Women, Pregnancy, And Motherhood: A Content Analysis Of National Policy And Programs From Nine Countries And Their Adherence To International Guidelines": 'Women comprise one-third of people who use drugs globally and account for one-fifth of the estimated global number of people who inject drugs [1].Women comprised one-third of overdose deaths in the US and about one in four in Canada in 2017-18.The rate of fatal overdoses among women has increased by 260-500% in the last two decades [2].Women also suffer serious longterm social and health consequences of incarceration related to drug use and drug-related offenses which are different to those suffered by men [3][4][5].The latest European report on Women and Drugs estimated one in four people with serious drug problems and one in five entrants to treatment programs were women.Despite the disease burden, the report lamented limited availability of integrated and coordinated national-level genderspecific services and gender-mainstreaming responses of drug use-related problems [6]. Women face particular challenges related to drugs including gender, effects of drug use during pregnancy (e.g., neonatal abstinence syndrome, low birth weight, and premature birth), motherhood, gender-based violence, higher involvement in sex work, higher prevalence of (sexual) trauma, double stigma (being discriminated against for being a woman and persons who use drugs) with serious psychosocial consequences [7].These challenges require gender-specific policy responses.Drug policy should be well-aligned with the objectives of sustainable development goals (SDG-2030), which envisage gender equality and empowerment [8].Therefore, it is important to assess whether women who use drugs currently receive attention in drug policies and programs and in what ways.Assessing gender-specific elements of national',
        'Demonstrating The Feasibility Of An Economic Empowerment And Health Promotion Intervention Among Low-Income Women Affected By Hiv In New York City': "assets [18]. If such guidelines are not followed, they may lose future funding and are penalized for every dollar they go over the designated maximum alliance for individual assets. Even if there may be a desire to work and to save money, government regulations may produce a disincentive to both. For women who are recovering from substance dependence and other related adverse life events (such as HIV infection, poor health, intimate partner violence, and mental health concerns), it may be difficult to see the value of engaging in economic empowerment activities with so little economic independence. This paper attempts to explore these issues to enhance our knowledge of effective interventions that support women on disability living in low-income communities and high-risk environments to gain access to the workforce. The Women's Economic Empowerment pilot (WEE) described here was initiated to better understand the acceptability and feasibility of implementing a structural intervention to promote women's economic empowerment in an urban context. Grounded in social cognitive [19,20] and asset theories [21], the intervention targeted behavior change by building women's self-efficacy in sexual health decision making and condom negotiation and use, while also promoting economic stability through training in financial literacy and the accumulation of economic assets. The study aimed to (1) explore whether a structural intervention combining health promotion with economic empowerment activities would be both acceptable and feasible among women receiving HIV prevention and related case management services in NYC and (2) obtain preliminary data that would support the design of a future efficacy trial. If we better understand the successes and challenges of implementation, we may improve the overall effectiveness of combination, structural economic empowerment interventions for low-income communities. As such, Figure 1 depicts the conceptual model for the combined intervention.",
        'Acceptability Of A Microfinance-Based Empowerment Intervention For Transgender And Cisgender Women Sex Workers In Greater Kuala Lumpur, Malaysia': "Sample characteristics, stratified by gender identity, are reported in Table 2. Participants were on average 41 years old (SD = 12); and were mostly of Malay (42%), Indian (42%), or Chinese (9%) ethnicity. The majority of participants identified as Muslim (55%), followed by Hindu (27%), Buddhist (9%), Christian (6%), or Sikh (3%). Many participants reported not completing secondary school (45%) and less than half (46%) had children. Participants' demographic traits differed according to their gender identity, with a substantially higher proportion of TWSWs reporting being single (87%), having no children (87%), and holding some form of secondary schooling qualification (60%) when compared to CWSW. Moreover, a larger percentage of CWSWs reported being widowed/divorced (72%) in comparison to their TWSW counterparts.  Table 3 reports participants' patterns of income generation, stratified by gender identity. Participants reported having engaged in sex work for an average of 20 years (SD = 12); although, both CWSWs (61%) and TWSWs (72%) reported receiving income from non-sex work forms of work, including cleaning services, entertainment, and night club promotion. Participants' total mean monthly income was MYR 2235 (USD 521). Table 4 shows rates of lifetime drug use, stratified by gender identity. The most commonly used drugs were amphetaminetype substances (ATS) (50%), primarily crystal methamphetamine, followed by cannabis (36%) and heroin (27%). Engagement in drug use differed according to respondents' gender identity; with a higher percentage of CWSWs using ATS (61%) and/or heroine (44%) in comparison to TWSWs.\n\nThe in-depth interviews yielded three main themes regarding acceptability of a microfinance intervention: (a) participants were eager to engage in additional forms of income generation due to familial concerns and career aspirations; (b) interest in all proposed components of the intervention were driven by a desire to build their own business; and (c) potential challenges to developing businesses included a lack of financial resources, competition from other businesses, and fear of stigma."
            }
    user_query = "I am the mayor of SF and I want to create a policy that fosters financial inclusion on the mission district. I want to implement this from a gender perspective focused on women that are substance users"
    

    memo = GenerateMemo()
    memo.run(all_external_content, content_by_title, user_query)




    


if __name__ == "__main__":
    main()